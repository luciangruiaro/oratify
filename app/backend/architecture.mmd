%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#0de7e7', 'primaryTextColor': '#eeeeee', 'primaryBorderColor': '#2c2d2f', 'lineColor': '#0de7e7', 'secondaryColor': '#c73a52', 'tertiaryColor': '#2c2d2f'}}}%%

flowchart TB
    subgraph Entry["Entry Point"]
        Main["main.py\nFastAPI App\nLifespan Events\nCORS Middleware"]
    end

    subgraph API["API Layer - app/api/"]
        AuthRoutes["auth.py âœ…\nregister, login, refresh,\nme, password-reset"]
        PresentationRoutes["presentations.py âœ…\nCRUD, duplicate, slug"]
        SlideRoutes["slides.py âœ…\nCRUD, reorder, validation"]
        SessionRoutes["sessions.py âœ…\nstart, end, pause,\ncurrent-slide, stats"]
        UploadRoutes["uploads.py âœ…\nimage upload + serving"]
        WSEndpoint["websocket.py âœ…\n/ws/session/join_code"]
        Deps["deps.py âœ…\nget_current_speaker\nget_db"]
        ResponseRoutes["responses.py ðŸ”²\nNot yet created"]
        AdminRoutes["admin.py ðŸ”²\nNot yet created"]
    end

    subgraph Core["Core Layer - app/core/"]
        Config["config.py âœ…\nPydantic Settings"]
        Security["security.py âœ…\nJWT + bcrypt\naccess & refresh tokens"]
        Database["database.py âœ…\nAsyncSession\nConnection Pool"]
        WSCore["websocket.py âœ…\nConnectionManager\nSession rooms"]
    end

    subgraph Models["Models - app/models/"]
        BaseModel["base.py âœ…\nTimestampMixin\nUUIDMixin"]
        SpeakerModel["speaker.py âœ…"]
        PresentationModel["presentation.py âœ…"]
        SlideModel["slide.py âœ…\nJSONB content"]
        SessionModel["session.py âœ…"]
        ParticipantModel["participant.py âœ…"]
        ResponseModel["response.py âœ…"]
    end

    subgraph Schemas["Schemas - app/schemas/"]
        AuthSchemas["auth.py âœ…"]
        PresentationSchemas["presentation.py âœ…"]
        SessionSchemas["session.py âœ…"]
        SlideSchemas["slide.py âœ…\n5 slide type schemas"]
        WSSchemas["websocket.py âœ…\nAll event messages"]
    end

    subgraph Services["Services - app/services/"]
        PresentationService["presentation.py âœ…"]
        SlideService["slide.py âœ…"]
        SessionService["session.py âœ…"]
        UploadService["upload.py âœ…"]
        WSEvents["websocket_events.py âœ…\nslide_changed, session_started,\nsession_ended, vote_update,\nquestion_asked, ai_response"]
        LLMService["llm.py ðŸ”²\nNot yet created"]
    end

    subgraph Tests["Tests - tests/"]
        TestAuth["test_auth.py âœ…"]
        TestPresentations["test_presentations.py âœ…"]
        TestSlides["test_slides.py âœ…"]
        TestSessions["test_sessions.py âœ…"]
        Conftest["conftest.py âœ…"]
    end

    subgraph Migrations["Alembic - alembic/"]
        AlembicEnv["env.py âœ…\nAsync Support"]
        Versions["versions/\ninitial_schema âœ…"]
    end

    subgraph External["External"]
        Postgres[(PostgreSQL 15)]
    end

    Main --> API
    Main --> Core
    API --> Schemas
    API --> Services
    API --> Deps
    Services --> Models
    Models --> Database
    Database --> Postgres
    Migrations --> Models

    style ResponseRoutes fill:#2c2d2f,stroke:#666
    style AdminRoutes fill:#2c2d2f,stroke:#666
    style LLMService fill:#2c2d2f,stroke:#666
