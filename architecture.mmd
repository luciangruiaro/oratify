%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#0de7e7', 'primaryTextColor': '#eeeeee', 'primaryBorderColor': '#2c2d2f', 'lineColor': '#0de7e7', 'secondaryColor': '#c73a52', 'tertiaryColor': '#2c2d2f'}}}%%

flowchart TB
    subgraph Clients["Client Applications"]
        AudienceWeb["Audience View\n(Mobile PWA)"]
        PresenterWeb["Presenter View\n(Desktop)"]
        ComposerWeb["Composer\n(Desktop)"]
        AdminWeb["Admin Dashboard\n(Desktop)"]
    end

    subgraph Frontend["Frontend Layer - React + Vite"]
        Router["React Router v6"]
        Redux["Redux Toolkit\nState Management"]
        WSClient["WebSocket Client"]
        APIClient["REST API Client\nAxios"]
    end

    subgraph Backend["Backend Layer - FastAPI + Python"]
        RestAPI["REST API\nEndpoints"]
        WSServer["WebSocket\nManager"]
        AuthService["Auth Service\nJWT"]
        SessionMgr["Session\nManager"]
        LLMService["LLM Service\nLiteLLM"]
    end

    subgraph Data["Data Layer"]
        Postgres[(PostgreSQL 15\nDatabase)]
        Cache["In-Memory Cache\nPython Dict"]
    end

    subgraph External["External Services"]
        OpenAI["OpenAI API\nGPT-4o-mini"]
        Ollama["Ollama\nLocal LLM"]
    end

    AudienceWeb --> Router
    PresenterWeb --> Router
    ComposerWeb --> Router
    AdminWeb --> Router

    Router --> Redux
    Redux --> APIClient
    Redux --> WSClient

    APIClient -->|HTTP/REST| RestAPI
    WSClient <-->|WebSocket| WSServer

    RestAPI --> AuthService
    RestAPI --> SessionMgr
    WSServer --> SessionMgr
    SessionMgr --> LLMService

    RestAPI --> Postgres
    SessionMgr --> Cache
    WSServer --> Cache

    LLMService --> OpenAI
    LLMService --> Ollama
